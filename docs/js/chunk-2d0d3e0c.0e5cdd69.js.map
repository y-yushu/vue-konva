{"version":3,"sources":["webpack:///./src/views/demo/Generate-background.vue","webpack:///src/views/demo/Generate-background.vue","webpack:///./src/views/demo/Generate-background.vue?6c13","webpack:///./src/views/demo/Generate-background.vue?e227"],"names":["render","_vm","this","_c","_self","staticClass","_m","staticStyle","attrs","on","$event","opendialog1","_v","opendialog2","getPicture","ref","visible1","changeFile","visible2","model","value","textProp","fontSize","callback","$$v","$set","expression","slot","fill","text","addTest","staticRenderFns","name","data","pageStage","layer","tran","texts","x","y","fontFamily","draggable","methods","link","document","reader","img","container","width","height","image","lion","nodes","centeredScaling","clickTap","component"],"mappings":"yHAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,iBAAiB,CAACJ,EAAIK,GAAG,GAAGH,EAAG,MAAM,CAACI,YAAY,CAAC,gBAAgB,SAAS,CAACJ,EAAG,YAAY,CAACK,MAAM,CAAC,KAAO,WAAWC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOT,EAAIU,iBAAiB,CAACV,EAAIW,GAAG,UAAUT,EAAG,YAAY,CAACK,MAAM,CAAC,KAAO,WAAWC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOT,EAAIY,iBAAiB,CAACZ,EAAIW,GAAG,UAAUT,EAAG,YAAY,CAACK,MAAM,CAAC,KAAO,WAAWC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOT,EAAIa,gBAAgB,CAACb,EAAIW,GAAG,WAAW,GAAGT,EAAG,MAAM,CAACY,IAAI,YAAYP,MAAM,CAAC,GAAK,eAAeL,EAAG,YAAY,CAACK,MAAM,CAAC,MAAQ,OAAO,QAAUP,EAAIe,SAAS,MAAQ,OAAOP,GAAG,CAAC,iBAAiB,SAASC,GAAQT,EAAIe,SAASN,KAAU,CAACP,EAAG,QAAQ,CAACY,IAAI,OAAOP,MAAM,CAAC,KAAO,OAAO,OAAS,yBAAyBC,GAAG,CAAC,OAASR,EAAIgB,gBAAgBd,EAAG,YAAY,CAACK,MAAM,CAAC,MAAQ,OAAO,QAAUP,EAAIiB,SAAS,MAAQ,OAAOT,GAAG,CAAC,iBAAiB,SAASC,GAAQT,EAAIiB,SAASR,KAAU,CAACP,EAAG,WAAW,CAACI,YAAY,CAAC,gBAAgB,QAAQC,MAAM,CAAC,YAAc,QAAQW,MAAM,CAACC,MAAOnB,EAAIoB,SAASC,SAAUC,SAAS,SAAUC,GAAMvB,EAAIwB,KAAKxB,EAAIoB,SAAU,WAAYG,IAAME,WAAW,sBAAsB,CAACvB,EAAG,WAAW,CAACwB,KAAK,WAAW,CAAC1B,EAAIW,GAAG,WAAW,GAAGT,EAAG,WAAW,CAACI,YAAY,CAAC,gBAAgB,QAAQC,MAAM,CAAC,YAAc,QAAQW,MAAM,CAACC,MAAOnB,EAAIoB,SAASO,KAAML,SAAS,SAAUC,GAAMvB,EAAIwB,KAAKxB,EAAIoB,SAAU,OAAQG,IAAME,WAAW,kBAAkB,CAACvB,EAAG,WAAW,CAACwB,KAAK,WAAW,CAAC1B,EAAIW,GAAG,WAAW,GAAGT,EAAG,WAAW,CAACI,YAAY,CAAC,gBAAgB,QAAQC,MAAM,CAAC,YAAc,QAAQW,MAAM,CAACC,MAAOnB,EAAIoB,SAASQ,KAAMN,SAAS,SAAUC,GAAMvB,EAAIwB,KAAKxB,EAAIoB,SAAU,OAAQG,IAAME,WAAW,kBAAkB,CAACvB,EAAG,WAAW,CAACwB,KAAK,WAAW,CAAC1B,EAAIW,GAAG,WAAW,GAAGT,EAAG,OAAO,CAACE,YAAY,gBAAgBG,MAAM,CAAC,KAAO,UAAUmB,KAAK,UAAU,CAACxB,EAAG,YAAY,CAACK,MAAM,CAAC,KAAO,WAAWC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOT,EAAI6B,aAAa,CAAC7B,EAAIW,GAAG,SAAS,IAAI,IAAI,IAEp5DmB,EAAkB,CAAC,WAAY,IAAI9B,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACA,EAAG,KAAK,CAACF,EAAIW,GAAG,gB,qBC8BlF,GACfoB,0BACAC,OACA,OACAC,eACAC,WACAC,UACAC,SACArB,YACAE,YACAG,UACAiB,IACAC,IACAV,mBACAP,YACAkB,qBACAZ,eACAa,gBAIAC,SAEA/B,cACA,kBAGAE,cACA,oDACA,kBAGAC,aACA,oDAEA,oBACA,kBAEA,oCACA6B,kCACAA,sBACAC,6BACAD,UACAC,8BAGA3B,aACA,iCACA,aACA,uBACA4B,gBACA,kBACAC,sBACAA,cACA,iBAEA,8BACAC,sBACAC,cACAC,kBAEA,sBACA,sBACA,uBACAC,QACAZ,IACAC,IACAS,cACAC,gBACAR,eAEAU,UACAA,kCACAhB,SACAA,SACA,aAEA,kBAGAU,oBAGAf,UACA,iBACA,oCACA,aACA,yBACA,CACA,6BACAsB,UACAC,qBAEA,kBACA,YAEA,mBACA,kBACA,wBAGAC,WACA,kCACA,eACA,yCACA,EACA,qBAEA,oBAEA,wBC9I4W,I,YCOxWC,EAAY,eACd,EACAvD,EACA+B,GACA,EACA,KACA,KACA,MAIa,aAAAwB,E","file":"js/chunk-2d0d3e0c.0e5cdd69.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"app-container\"},[_vm._m(0),_c('div',{staticStyle:{\"margin-bottom\":\"10px\"}},[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.opendialog1()}}},[_vm._v(\"上传背景\")]),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.opendialog2()}}},[_vm._v(\"增加文字\")]),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.getPicture()}}},[_vm._v(\"下载图片\")])],1),_c('div',{ref:\"container\",attrs:{\"id\":\"container\"}}),_c('el-dialog',{attrs:{\"title\":\"选择背景\",\"visible\":_vm.visible1,\"width\":\"30%\"},on:{\"update:visible\":function($event){_vm.visible1=$event}}},[_c('input',{ref:\"file\",attrs:{\"type\":\"file\",\"accept\":\"image/png, image/jpeg\"},on:{\"change\":_vm.changeFile}})]),_c('el-dialog',{attrs:{\"title\":\"文字信息\",\"visible\":_vm.visible2,\"width\":\"30%\"},on:{\"update:visible\":function($event){_vm.visible2=$event}}},[_c('el-input',{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{\"placeholder\":\"输入字号\"},model:{value:(_vm.textProp.fontSize),callback:function ($$v) {_vm.$set(_vm.textProp, \"fontSize\", $$v)},expression:\"textProp.fontSize\"}},[_c('template',{slot:\"prepend\"},[_vm._v(\"输入字号\")])],2),_c('el-input',{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{\"placeholder\":\"输入色号\"},model:{value:(_vm.textProp.fill),callback:function ($$v) {_vm.$set(_vm.textProp, \"fill\", $$v)},expression:\"textProp.fill\"}},[_c('template',{slot:\"prepend\"},[_vm._v(\"输入色号\")])],2),_c('el-input',{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{\"placeholder\":\"输入文本\"},model:{value:(_vm.textProp.text),callback:function ($$v) {_vm.$set(_vm.textProp, \"text\", $$v)},expression:\"textProp.text\"}},[_c('template',{slot:\"prepend\"},[_vm._v(\"输入文本\")])],2),_c('span',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.addTest()}}},[_vm._v(\"添加\")])],1)],1)],1)\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',[_c('h1',[_vm._v(\"生成背景图片\")])])\n}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"app-container\">\r\n    <div><h1>生成背景图片</h1></div>\r\n    <div style=\"margin-bottom: 10px\">\r\n      <el-button type=\"primary\" @click=\"opendialog1()\">上传背景</el-button>\r\n      <el-button type=\"primary\" @click=\"opendialog2()\">增加文字</el-button>\r\n      <el-button type=\"primary\" @click=\"getPicture()\">下载图片</el-button>\r\n    </div>\r\n    <div id=\"container\" ref=\"container\" />\r\n    <el-dialog title=\"选择背景\" :visible.sync=\"visible1\" width=\"30%\">\r\n      <input ref=\"file\" type=\"file\" accept=\"image/png, image/jpeg\" @change=\"changeFile\" />\r\n    </el-dialog>\r\n    <el-dialog title=\"文字信息\" :visible.sync=\"visible2\" width=\"30%\">\r\n      <el-input v-model=\"textProp.fontSize\" placeholder=\"输入字号\" style=\"margin-bottom: 10px\">\r\n        <template slot=\"prepend\">输入字号</template>\r\n      </el-input>\r\n      <el-input v-model=\"textProp.fill\" placeholder=\"输入色号\" style=\"margin-bottom: 10px\">\r\n        <template slot=\"prepend\">输入色号</template>\r\n      </el-input>\r\n      <el-input v-model=\"textProp.text\" placeholder=\"输入文本\" style=\"margin-bottom: 10px\">\r\n        <template slot=\"prepend\">输入文本</template>\r\n      </el-input>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button type=\"primary\" @click=\"addTest()\">添加</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Konva from 'konva'\r\n\r\nexport default {\r\n  name: 'GenerateBackground',\r\n  data() {\r\n    return {\r\n      pageStage: null, // 总容器\r\n      layer: null, // 第一层\r\n      tran: null, // 选择器\r\n      texts: [], // 所有文字\r\n      visible1: false, // 背景弹窗\r\n      visible2: false, // 文字弹窗\r\n      textProp: {\r\n        x: 0,\r\n        y: 0,\r\n        text: 'Simple Text',\r\n        fontSize: 45,\r\n        fontFamily: 'Calibri',\r\n        fill: '#ffffff',\r\n        draggable: true\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    // 按钮 上传背景\r\n    opendialog1() {\r\n      this.visible1 = true\r\n    },\r\n    // 按钮 增加文字\r\n    opendialog2() {\r\n      if (!this.layer) return this.$message.error('请先上传背景')\r\n      this.visible2 = true\r\n    },\r\n    // 按钮 下载图片\r\n    getPicture() {\r\n      if (!this.layer) return this.$message.error('请先上传背景')\r\n      // 取消所有选择框\r\n      this.tran.nodes([])\r\n      this.layer.draw()\r\n      // 下载图片\r\n      const link = document.createElement('a')\r\n      link.href = this.pageStage.toDataURL()\r\n      link.download = 'text.png'\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      document.body.removeChild(link)\r\n    },\r\n    // 选择图片上传\r\n    changeFile() {\r\n      const file = this.$refs.file.files[0]\r\n      if (!file) return\r\n      const reader = new FileReader()\r\n      reader.onloadend = e => {\r\n        const img = new Image()\r\n        img.src = e.target.result\r\n        img.onload = () => {\r\n          this.visible1 = false // 关闭弹窗\r\n          // 创建容器\r\n          this.pageStage = new Konva.Stage({\r\n            container: 'container',\r\n            width: img.width,\r\n            height: img.height\r\n          })\r\n          const layer = new Konva.Layer()\r\n          this.pageStage.add(layer)\r\n          const lion = new Konva.Image({\r\n            image: img,\r\n            x: 0,\r\n            y: 0,\r\n            width: img.width,\r\n            height: img.height,\r\n            draggable: false\r\n          })\r\n          lion.cache()\r\n          lion.filters([Konva.Filters.Brighten])\r\n          layer.add(lion)\r\n          layer.draw()\r\n          this.layer = layer\r\n          // 增加鼠标点击事件\r\n          this.clickTap()\r\n        }\r\n      }\r\n      reader.readAsDataURL(file)\r\n    },\r\n    // 添加文字\r\n    addTest() {\r\n      this.visible2 = false\r\n      const graph = new Konva.Text(this.textProp)\r\n      if (this.tran) {\r\n        this.tran.nodes([graph])\r\n      } else {\r\n        const tran = new Konva.Transformer({\r\n          nodes: [graph],\r\n          centeredScaling: false\r\n        })\r\n        this.layer.add(tran)\r\n        this.tran = tran\r\n      }\r\n      this.texts.push(graph)\r\n      this.layer.add(graph)\r\n      this.layer.batchDraw()\r\n    },\r\n    // 监听--点击事件\r\n    clickTap() {\r\n      this.pageStage.on('click tap', e => {\r\n        if (this.texts) {\r\n          const text = this.texts.find(f => e.target === f)\r\n          if (text) {\r\n            this.tran.nodes([text])\r\n          } else {\r\n            this.tran.nodes([])\r\n          }\r\n          this.layer.draw()\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Generate-background.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Generate-background.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Generate-background.vue?vue&type=template&id=3071fec0&\"\nimport script from \"./Generate-background.vue?vue&type=script&lang=js&\"\nexport * from \"./Generate-background.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}